<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的小卡收集冊 - 進度追蹤</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #fdf6f6; text-align: center; padding: 20px; color: #444; }
        
        .progress-container {
            position: sticky; top: 0; background: white; padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 100; margin-bottom: 20px;
            border-radius: 0 0 15px 15px;
        }
        .progress-bar-bg { width: 100%; max-width: 500px; height: 20px; background: #eee; border-radius: 10px; margin: 10px auto; overflow: hidden; }
        .progress-bar-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #ffb6c1, #ff69b4); transition: width 0.3s ease; }
        
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 10px; }
        

.card {
    width: 120px; 
    border: 2px solid #eee; 
    border-radius: 12px;
    overflow: hidden; 
    cursor: pointer; 
    background: white;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    filter: grayscale(100%) brightness(0.9);
    position: relative;
    z-index: 1;
}
        
.card.owned {
    filter: grayscale(0%) brightness(1) !important; 
    border-color: #ff69b4 !important;
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
}
        
.card:hover {
    transform: scale(1.5); 
    z-index: 10;     
    filter: grayscale(30%) brightness(1.05) !important; 
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
}

.card.owned:hover {
    filter: grayscale(0%) brightness(1.1);
    box-shadow: 0 10px 25px rgba(255, 105, 180, 0.4);
}

.card img {
    width: 100%;
    aspect-ratio: 2/3;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
}
        
        .card-info { font-size: 11px; padding: 8px; line-height: 1.4; }
        
        h1 { color: #ff69b4; margin-bottom: 5px; }
        .stats-text { font-weight: bold; font-size: 18px; color: #ff4081; }

        .filter-container {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 10px;
}
.filter-container select {
    padding: 8px 15px;
    border-radius: 20px;
    border: 1px solid #ffb6c1;
    background: white;
    color: #444;
    outline: none;
    cursor: pointer;
}

#loading-overlay {
    position: fixed; 
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(255, 255, 255, 0.9); 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    z-index: 9999; 
    transition: opacity 0.3s ease-in-out;
    opacity: 1; 
}

.loading-spinner {
    width: 80px;
    height: 80px;
    display: block; 
    margin: 0 auto 15px auto; 
}

#loading-overlay.hidden {
    opacity: 0; 
    pointer-events: none; 
}
    </style>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
<div id="loading-overlay">
            <img src="logo.gif" alt="Loading..." class="loading-spinner">
    </div>
    <div class="progress-container">
        <h1>小卡收集進度</h1>
        <div class="stats-text" id="stats">已收集 0 / 0 (0%)</div>
        <div class="progress-bar-bg">
            <div id="progress-fill" class="progress-bar-fill"></div>
        </div>
        <div class="filter-container">
    <select id="filter-category">
        <option value="">所有分類</option>
    </select>
    <select id="filter-member">
        <option value="">所有成員</option>
    </select>
</div>
    </div>

    <div class="container" id="gallery"></div>
    <script>
    const api_url = 'https://script.google.com/macros/s/AKfycbxyGc65RVluqkrHIZp7AX1e6-xAZiaeK8EYCCryr5Aq3YxRojZhI-rq0UIltMQJZ4nl/exec'; 
    const gallery = document.getElementById('gallery');
    const statsText = document.getElementById('stats');
    const progressFill = document.getElementById('progress-fill');
    const selectCategory = document.getElementById('filter-category');
    const selectMember = document.getElementById('filter-member');
    const loadingOverlay = document.getElementById('loading-overlay');

    let globalCardData = []; 

async function fetchData() {
    loadingOverlay.classList.remove('hidden'); 
    try {
        const response = await fetch(api_url);
        const data = await response.json();
        globalCardData = data;
        
        setupFilters(); 
        applyFilters(); 
        
       setTimeout(() => {
            loadingOverlay.classList.add('hidden');
        }, 300); 
    } catch (error) {
        console.error('抓取資料失敗:', error);
        loadingOverlay.querySelector('p').innerText = '讀取失敗，請檢查網路。'; 
        loadingOverlay.querySelector('img').style.display = 'none';
    }
}

    function setupFilters() {
        const categories = [...new Set(globalCardData.map(c => c.category))].filter(Boolean);
        const members = [...new Set(globalCardData.map(c => c.member))].filter(Boolean);

        categories.forEach(cat => {
            const opt = new Option(cat, cat);
            selectCategory.add(opt);
        });

        members.forEach(mem => {
            const opt = new Option(mem, mem);
            selectMember.add(opt);
        });

        if (selectCategory.options.length > 1) {
            selectCategory.selectedIndex = 1; 
        }
        if (selectMember.options.length > 1) {
            selectMember.selectedIndex = 1;  
        }

        selectCategory.onchange = applyFilters;
        selectMember.onchange = applyFilters;
    }

    function applyFilters() {
        const catValue = selectCategory.value;
        const memValue = selectMember.value;

        const filtered = globalCardData.filter(card => {
            const matchCat = catValue === "" || card.category === catValue;
            const matchMem = memValue === "" || card.member === memValue;
            return matchCat && matchMem;
        });

        renderCards(filtered);
    }

    function renderCards(cardsToDisplay) {
    gallery.innerHTML = '';
    cardsToDisplay.forEach(card => {
        const cardEl = document.createElement('div');
        cardEl.className = 'card';
        const storageId = `pc-${card.id}`;
        
        if (localStorage.getItem(storageId) === 'true') {
            cardEl.classList.add('owned');
        }

        cardEl.innerHTML = `
            <img src="${card.img}" loading="lazy" onerror="this.src='https://via.placeholder.com/150x210?text=Error'">
            <div class="card-info">
                <strong>${card.name || ' '}</strong><br>
                ${card.member || ''} (${card.category || ''})
            </div>
        `;

        cardEl.onclick = function() {
            this.classList.toggle('owned');
            localStorage.setItem(storageId, this.classList.contains('owned'));
            updateStats(); 
        };
        gallery.appendChild(cardEl);
    });
    updateStats(); 
}

    function updateStats() {
        const total = globalCardData.length;
        let ownedCount = 0;
        globalCardData.forEach(card => {
            if (localStorage.getItem(`pc-${card.id}`) === 'true') {
                ownedCount++;
            }
        });

        const percentage = total === 0 ? 0 : Math.round((ownedCount / total) * 100);
        statsText.innerText = `已收集 ${ownedCount} / ${total} (${percentage}%)`;
        progressFill.style.width = `${percentage}%`;
    }

    fetchData();
</script>
</body>

</html>









